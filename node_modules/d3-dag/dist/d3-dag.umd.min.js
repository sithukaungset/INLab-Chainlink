!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{})}(this,(function(t){"use strict";class e{constructor(t){this.base=t}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...t){return r(function*(t){for(const e of t)yield*e}([this,...t.map(r)]))}entries(){return r(function*(t){let e=0;for(const r of t)yield[e++,r]}(this))}every(t){return!this.some(((e,r)=>!t(e,r)))}fill(t){return this.map((()=>t))}filter(t){return r(function*(e){for(const[r,i]of e)t(i,r)&&(yield i)}(this.entries()))}find(t){for(const[e,r]of this.entries())if(t(r,e))return r}findIndex(t){for(const[e,r]of this.entries())if(t(r,e))return e;return-1}flatMap(t){return r(function*(e){for(const[i,n]of e)yield*r(t(n,i))}(this.entries()))}forEach(t){for(const[e,r]of this.entries())t(r,e)}includes(t,e=0){return this.indexOf(t,e)>=0}indexOf(t,e=0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[r,i]of this.entries())if(r>=e&&i===t)return r;return-1}join(t=","){return[...this].join(t)}keys(){return r(function*(t){let e=0;for(const r of t)yield e++}(this))}lastIndexOf(t,e=1/0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let r=-1;for(const[i,n]of this.entries())i<=e&&n===t&&(r=i);return r}get length(){return this.reduce((t=>t+1),0)}map(t){return r(function*(e){for(const[r,i]of e)yield t(i,r)}(this.entries()))}reduce(t,e){if(void 0===e){const e=t;let r=!0,i=void 0;for(const[t,n]of this.entries())r?(i=n,r=!1):i=e(i,n,t);if(r)throw new TypeError("Reduce of empty iterable with no initial value");return i}{const r=t;let i=e;for(const[t,e]of this.entries())i=r(i,e,t);return i}}reverse(){return r([...this].reverse())}slice(t=0,e=1/0){return r(function*(r){for(const[i,n]of r)if(i<t);else{if(!(i<e))break;yield n}}(this.entries()))}some(t){for(const[e,r]of this.entries())if(t(r,e))return!0;return!1}sort(t){return r([...this].sort(t))}splice(t,e=0,...i){return r(function*(r){for(const[n,o]of r)n===t&&(yield*i),(n<t||n>=t+e)&&(yield o)}(this.entries()))}values(){return this}}function r(t){return function(t){return"function"==typeof t[Symbol.iterator]}(t)?new e(t):new e({[Symbol.iterator]:()=>t})}function i(t){if(void 0!==t)return t;throw new Error("got unexpected undefined value")}function n(t,e){e.size<t.size&&([e,t]=[t,e]);for(const r of t)if(e.has(r))return!0;return!1}class o extends Map{getThrow(t){const e=this.get(t);if(void 0===e)throw new Error("map doesn't contain key: "+t);return e}getDefault(t,e){const r=this.get(t);return void 0===r?e:r}setIfAbsent(t,e){const r=this.get(t);return void 0===r?(this.set(t,e),e):r}}class s{constructor(t,e,r=[]){this.child=t,this.data=e,this.points=r}}class a{constructor(t,e,r,i){this.source=t,this.target=e,this.data=r,this.points=i}}class h{constructor(t,e){this.id=t,this.data=e,this.dataChildren=[]}iroots(){return r([this])}roots(){return[this]}*iterChildren(){for(const{child:t}of this.dataChildren)yield t}ichildren(){return r(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:t,data:e,points:r}of this.dataChildren)yield new a(this,t,e,r)}ichildLinks(){return r(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new l([this])[Symbol.iterator]()}idescendants(t="depth"){return new l([this]).idescendants(t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return new l([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new l([this]).size()}sum(t){return new l([this]).sum(t),this}count(){return new l([this]).count(),this}height(){return new l([this]).height(),this}depth(){return new l([this]).depth(),this}split(){return[this]}connected(){return!0}}class l{constructor(t){this.dagRoots=t}[Symbol.iterator](){return this.idepth()}iroots(){return r(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(e.add(r.id),yield r,t.push(...r.ichildren()))}*ibreadth(){const t=new Set;let e=this.roots(),r=[];do{let i;for(r=e.reverse(),e=[];i=r.pop();)t.has(i.id)||(t.add(i.id),yield i,e.push(...i.ichildren()))}while(e.length)}*ibefore(){const t=new o;for(const e of this)for(const r of e.ichildren())t.set(r.id,t.getDefault(r.id,0)+1);const e=this.roots();let r;for(;r=e.pop();){yield r;for(const i of r.ichildren()){const r=t.getThrow(i.id);r>1?t.set(i.id,r-1):e.push(i)}}}*iafter(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(r.ichildren().every((t=>e.has(t.id)))?(e.add(r.id),yield r):(t.push(r),t.push(...r.ichildren())))}idescendants(t="depth"){if("depth"===t)return r(this.idepth());if("breadth"===t)return r(this.ibreadth());if("before"===t)return r(this.ibefore());if("after"===t)return r(this.iafter());throw new Error("unknown iteration style: "+t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return this.idescendants().flatMap((t=>t.ichildLinks()))}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce((t=>t+1),0)}sum(t){const e=new o;for(const[i,n]of this.idescendants("after").entries()){const s=t(n,i),a=new o;a.set(n.id,s);for(const t of n.ichildren()){const r=e.getThrow(t.id);for(const[t,e]of r.entries())a.set(t,e)}n.value=r(a.entries()).map((([,t])=>t)).reduce(((t,e)=>t+e)),e.set(n.id,a)}return this}count(){const t=new o;for(const e of this.idescendants("after"))if(e.ichildren()[Symbol.iterator]().next().done)t.set(e.id,new Set([e.id])),e.value=1;else{const r=new Set;for(const i of e.ichildren()){const e=t.getThrow(i.id);for(const t of e)r.add(t)}t.set(e.id,r),e.value=r.size}return this}height(){for(const t of this.idescendants("after"))t.value=Math.max(0,...t.ichildren().map((t=>{if(void 0===t.value)throw new Error("`after` iteration didn't iterate in after order");return t.value+1})));return this}depth(){const t=new o;for(const e of this)for(const r of e.ichildren())t.setIfAbsent(r.id,[]).push(e);for(const e of this.idescendants("before"))e.value=Math.max(0,...t.getDefault(e.id,[]).map((t=>{if(void 0===t.value)throw new Error("`before` iteration didn't iterate in before order");return t.value+1})));return this}split(){const t=new o,e=new o;for(const r of this.iroots())t.set(r.id,[]),e.set(r.id,new Set(r.idescendants().map((t=>t.id))));for(const[r,i]of this.iroots().entries()){const o=e.getThrow(i.id);for(const s of this.iroots().slice(r+1)){n(o,e.getThrow(s.id))&&(t.getThrow(i.id).push(s),t.getThrow(s.id).push(i))}}const r=[],i=new Set;for(const e of this.iroots())if(!i.has(e.id)){i.add(e.id);const n=[e];r.push(n);const o=t.getThrow(e.id).slice();let s;for(;s=o.pop();)i.has(s.id)||(i.add(s.id),n.push(s),o.push(...t.getThrow(s.id)))}return r.map((t=>t.length>1?new l(t):t[0]))}connected(){return 1===this.split().length}}function c(t){if("string"!=typeof t)throw new Error("id is supposed to be string but got type "+typeof t);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function f(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,r=new Set;let i=null;function n(t){if(e.has(t.id))return[];if(r.has(t.id))return i=t.id,[t.id];{r.add(t.id);let o=[];for(const e of t.ichildren())if(o=n(e),o.length)break;return r.delete(t.id),e.add(t.id),o.length&&null!==i&&o.push(t.id),i===t.id&&(i=null),o}}for(const e of t){const t=n(e);if(t.length)throw new Error("dag contained a cycle: "+t.reverse().join(" -> "))}for(const e of new l(t)){if(new Set(e.ichildren().map((t=>t.id))).size!==e.dataChildren.length)throw new Error(`node '${e.id}' contained duplicate children`)}}function u(t,e,r){function i(e){if(!e.length)throw new Error("can't stratify empty data");const i=e.map(((e,r)=>new h(c(t(e,r)),e))),n=new Map;i.forEach((t=>{if(n.has(t.id))throw new Error("found a duplicate id: "+t.id);n.set(t.id,t)}));const o=[];return i.forEach(((t,e)=>{const i=r(t.data,e)||[];i.forEach((([e,r])=>{const i=n.get(e);if(!i)throw new Error("missing id: "+e);return i.dataChildren.push(new s(t,r)),i})),i.length||o.push(t)})),f(o),o.length>1?new l(o):o[0]}return i.id=function(i){return void 0===i?t:u(i,e,r)},i.parentData=function(e){return void 0===e?r:u(t,function(t){function e(e,r){return(t(e,r)||[]).map((([t])=>t))}return e.wrapped=t,e}(e),e)},i.parentIds=function(r){return void 0===r?e:u(t,r,d(r))},i}function d(t){function e(e,r){return(t(e,r)||[]).map((t=>[t,void 0]))}return e.wrapped=t,e}function p(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field but got: "+t)}function v(t){if(function(t){try{const e=t.parentIds;return void 0===e||e instanceof Array&&e.every((t=>"string"==typeof t))}catch(t){return!1}}(t))return t.parentIds;throw new Error("default parentIds function expected datum to have a parentIds field but got: "+t)}function m(t,e){function r(r){if(!r.length)throw new Error("can't connect empty data");const n=new Map,o=new Map;for(const[i,a]of r.entries()){const r=c(t(a,i));let l=n.get(r);void 0===l&&(l=new h(r,void 0),n.set(r,l));const f=c(e(a,i));let u=n.get(f);void 0===u&&(u=new h(f,void 0),n.set(f,u)),l.dataChildren.push(new s(u,a)),o.set(r,o.get(r)||!1),o.set(f,!0)}const a=[];for(const[t,e]of o)e||a.push(i(n.get(t)));return f(a),a.length>1?new l(a):a[0]}return r.sourceId=function(r){return void 0===r?t:m(r,e)},r.targetId=function(r){return void 0===r?e:m(t,r)},r}function g(t){if(function(t){try{return"string"==typeof t[0]}catch(t){return!1}}(t))return t[0];throw new Error("default source id expected datum[0] to be a string but got datum: "+t)}function y(t){if(function(t){try{return"string"==typeof t[1]}catch(t){return!1}}(t))return t[1];throw new Error("default target id expected datum[1] to be a string but got datum: "+t)}function w(t,e,r){function i(...e){if(!e.length)throw new Error("must pass in at least one node");const i=new Map,n=[];function o(e){const r=c(t(e));let o=i.get(r);if(void 0===o)o=new h(r,e),i.set(r,o),n.push(o);else if(e!==o.data)throw new Error("found duplicate id with different data: "+r);return o}const a=e.map(o);let u,d=0;for(;u=n.pop();)u.dataChildren=(r(u.data,d++)||[]).map((([t,e])=>new s(o(t),e)));const p=new Set(a.map((t=>t.id)));for(const t of i.values())if(t.ichildren().some((t=>p.has(t.id))))throw new Error(`node ${t.id} pointed to a root`);return f(a),a.length>1?new l(a):a[0]}return i.id=function(i){return void 0===i?t:w(i,e,r)},i.children=function(r){return void 0===r?e:w(t,r,x(r))},i.childrenData=function(e){return void 0===e?r:w(t,function(t){function e(e,r){return(t(e,r)||[]).map((([t])=>t))}return e.wrapped=t,e}(e),e)},i}function x(t){function e(e,r){return(t(e,r)||[]).map((t=>[t,void 0]))}return e.wrapped=t,e}function b(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field by got: "+t)}function I(t){if(function(t){try{const e=t.children;return void 0===e||e instanceof Array}catch(t){return!1}}(t))return t.children;throw new Error("default children function expected datum to have a children field but got: "+t)}let C,M,B=1e-60;do{B+=B,C=1+.1*B,M=1+.2*B}while(C<=1||M<=1);var E=B;var V=function(t,e,r){let i,n;for(let e=1;e<=r;e+=1){t[e][e]=1/t[e][e],n=-t[e][e];for(let r=1;r<e;r+=1)t[r][e]*=n;if(i=e+1,r<i)break;for(let o=i;o<=r;o+=1){n=t[e][o],t[e][o]=0;for(let r=1;r<=e;r+=1)t[r][o]+=n*t[r][e]}}};var O=function(t,e,r,i){let n,o;for(n=1;n<=r;n+=1){o=0;for(let e=1;e<n;e+=1)o+=t[e][n]*i[e];i[n]=(i[n]-o)/t[n][n]}for(let e=1;e<=r;e+=1){n=r+1-e,i[n]/=t[n][n],o=-i[n];for(let e=1;e<n;e+=1)i[e]+=o*t[e][n]}};var j=function(t,e,r,i){let n,o,s;for(let e=1;e<=r;e+=1){if(i[1]=e,s=0,n=e-1,n<1){if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}else{for(let r=1;r<=n;r+=1){o=t[r][e];for(let i=1;i<r;i+=1)o-=t[i][e]*t[i][r];o/=t[r][r],t[r][e]=o,s+=o*o}if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}i[1]=0}};var $=function(t,e,r,i,n,o,s,a,h,l,c,f,u,d=0,p,v,m){let g,y,w,x,b,I,C,M,B,$,k,T,z,_;const S=Math.min(i,c);let R=2*i+S*(S+5)/2+2*c+1;for(let t=1;t<=i;t+=1)v[t]=e[t];for(let t=i+1;t<=R;t+=1)v[t]=0;for(let t=1;t<=c;t+=1)u[t]=0,o[t]=0;const P=[];if(0===m[1]){if(j(t,r,i,P),0!==P[1])return void(m[1]=2);O(t,r,i,e),V(t,r,i)}else{for(let r=1;r<=i;r+=1){n[r]=0;for(let i=1;i<=r;i+=1)n[r]+=t[i][r]*e[i]}for(let r=1;r<=i;r+=1){e[r]=0;for(let o=r;o<=i;o+=1)e[r]+=t[r][o]*n[o]}}s[1]=0;for(let r=1;r<=i;r+=1){n[r]=e[r],s[1]+=v[r]*n[r],v[r]=0;for(let e=r+1;e<=i;e+=1)t[e][r]=0}s[1]=-s[1]/2,m[1]=0;const A=i,N=A+i,F=N+S,q=F+S+1,D=q+S*(S+1)/2,L=D+c;for(let t=1;t<=c;t+=1){I=0;for(let e=1;e<=i;e+=1)I+=a[e][t]*a[e][t];v[L+t]=Math.sqrt(I)}function U(){p[1]+=1,R=D;for(let t=1;t<=c;t+=1){R+=1,I=-h[t];for(let e=1;e<=i;e+=1)I+=a[e][t]*n[e];if(Math.abs(I)<E&&(I=0),t>f)v[R]=I;else if(v[R]=-Math.abs(I),I>0){for(let e=1;e<=i;e+=1)a[e][t]=-a[e][t];h[t]=-h[t]}}for(let t=1;t<=x;t+=1)v[D+u[t]]=0;w=0,b=0;for(let t=1;t<=c;t+=1)v[D+t]<b*v[L+t]&&(w=t,b=v[D+t]/v[L+t]);if(0===w){for(let t=1;t<=x;t+=1)o[u[t]]=v[F+t];return 999}return 0}function H(){for(let e=1;e<=i;e+=1){I=0;for(let r=1;r<=i;r+=1)I+=t[r][e]*a[r][w];v[e]=I}g=A;for(let t=1;t<=i;t+=1)v[g+t]=0;for(let e=x+1;e<=i;e+=1)for(let r=1;r<=i;r+=1)v[g+r]=v[g+r]+t[r][e]*v[e];T=!0;for(let t=x;t>=1;t-=1){I=v[t],R=q+t*(t+3)/2,g=R-t;for(let e=t+1;e<=x;e+=1)I-=v[R]*v[N+e],R+=e;I/=v[g],v[N+t]=I,u[t]<=f||(I<=0||(T=!1,y=t))}if(!T){C=v[F+y]/v[N+y];for(let t=1;t<=x;t+=1)u[t]<=f||v[N+t]<=0||(b=v[F+t]/v[N+t],b<C&&(C=b,y=t))}I=0;for(let t=A+1;t<=A+i;t+=1)I+=v[t]*v[t];if(Math.abs(I)<=E){if(T)return m[1]=1,999;for(let t=1;t<=x;t+=1)v[F+t]=v[F+t]-C*v[N+t];return v[F+x+1]=v[F+x+1]+C,700}I=0;for(let t=1;t<=i;t+=1)I+=v[A+t]*a[t][w];M=-v[D+w]/I,z=!0,T||C<M&&(M=C,z=!1);for(let t=1;t<=i;t+=1)n[t]+=M*v[A+t],Math.abs(n[t])<E&&(n[t]=0);s[1]+=M*I*(M/2+v[F+x+1]);for(let t=1;t<=x;t+=1)v[F+t]=v[F+t]-M*v[N+t];if(v[F+x+1]=v[F+x+1]+M,!z){I=-h[w];for(let t=1;t<=i;t+=1)I+=n[t]*a[t][w];if(w>f)v[D+w]=I;else if(v[D+w]=-Math.abs(I),I>0){for(let t=1;t<=i;t+=1)a[t][w]=-a[t][w];h[w]=-h[w]}return 700}x+=1,u[x]=w,R=q+(x-1)*x/2+1;for(let t=1;t<=x-1;t+=1)v[R]=v[t],R+=1;if(x===i)v[R]=v[i];else{for(let e=i;e>=x+1;e-=1)if(0!==v[e]&&(B=Math.max(Math.abs(v[e-1]),Math.abs(v[e])),$=Math.min(Math.abs(v[e-1]),Math.abs(v[e])),b=v[e-1]>=0?Math.abs(B*Math.sqrt(1+$*$/(B*B))):-Math.abs(B*Math.sqrt(1+$*$/(B*B))),B=v[e-1]/b,$=v[e]/b,1!==B))if(0===B){v[e-1]=$*b;for(let r=1;r<=i;r+=1)b=t[r][e-1],t[r][e-1]=t[r][e],t[r][e]=b}else{v[e-1]=b,k=$/(1+B);for(let r=1;r<=i;r+=1)b=B*t[r][e-1]+$*t[r][e],t[r][e]=k*(t[r][e-1]+b)-t[r][e],t[r][e-1]=b}v[R]=v[x]}return 0}function W(){if(R=q+y*(y+1)/2+1,g=R+y,0===v[g])return 798;if(B=Math.max(Math.abs(v[g-1]),Math.abs(v[g])),$=Math.min(Math.abs(v[g-1]),Math.abs(v[g])),b=v[g-1]>=0?Math.abs(B*Math.sqrt(1+$*$/(B*B))):-Math.abs(B*Math.sqrt(1+$*$/(B*B))),B=v[g-1]/b,$=v[g]/b,1===B)return 798;if(0===B){for(let t=y+1;t<=x;t+=1)b=v[g-1],v[g-1]=v[g],v[g]=b,g+=t;for(let e=1;e<=i;e+=1)b=t[e][y],t[e][y]=t[e][y+1],t[e][y+1]=b}else{k=$/(1+B);for(let t=y+1;t<=x;t+=1)b=B*v[g-1]+$*v[g],v[g]=k*(v[g-1]+b)-v[g],v[g-1]=b,g+=t;for(let e=1;e<=i;e+=1)b=B*t[e][y]+$*t[e][y+1],t[e][y+1]=k*(t[e][y]+b)-t[e][y+1],t[e][y]=b}return 0}function J(){g=R-y;for(let t=1;t<=y;t+=1)v[g]=v[R],R+=1,g+=1;return v[F+y]=v[F+y+1],u[y]=u[y+1],y+=1,y<x?797:0}function G(){return v[F+x]=v[F+x+1],v[F+x+1]=0,u[x]=0,x-=1,p[2]+=1,0}for(x=d,p[1]=0,p[2]=0,_=0;;){if(_=U(),999===_)return;for(;_=H(),0!==_;){if(999===_)return;if(700===_)if(y===x)G();else{for(;W(),_=J(),797===_;);G()}}}};var k={solveQP:function(t,e,r,i=[],n=0,o=[0,0]){const s=[],a=[],h=[],l=[],c=[],f=[];let u="";const d=t.length-1,p=r[1].length-1;if(!i)for(let t=1;t<=p;t+=1)i[t]=0;if(d!==t[1].length-1&&(u="Dmat is not symmetric!"),d!==e.length-1&&(u="Dmat and dvec are incompatible!"),d!==r.length-1&&(u="Amat and dvec are incompatible!"),p!==i.length-1&&(u="Amat and bvec are incompatible!"),(n>p||n<0)&&(u="Value of meq is invalid!"),""!==u)return{message:u};for(let t=1;t<=p;t+=1)a[t]=0,l[t]=0;const v=Math.min(d,p);for(let t=1;t<=d;t+=1)h[t]=0;s[1]=0;for(let t=1;t<=2*d+v*(v+5)/2+2*p+1;t+=1)c[t]=0;for(let t=1;t<=2;t+=1)f[t]=0;return $(t,e,d,d,h,l,s,r,i,d,p,n,a,0,f,c,o),1===o[1]&&(u="constraints are inconsistent, no solution!"),2===o[1]&&(u="matrix D in quadratic function is not positive definite!"),{solution:h,Lagrangian:l,value:s,unconstrained_solution:e,iterations:f,iact:a,message:u}}};function T(t,e){let[r,...i]=t,n=r.x=0;for(const t of i)n=t.x=n+e(r,t),r=t;if(n>0)for(const e of t)e.x/=n;else for(const e of t)e.x=.5}function z(t,e,r,i,n=0){e.pop(),t.pop(),t.forEach((t=>t.pop())),r.forEach((t=>t.pop()));const o=function(t,e,r,i,n){const o=[[0]],s=[0],a=[[0]],h=[0];for(const e of t){const t=[0];t.push(...e),o.push(t)}s.push(...e),a.push(...e.map((()=>[0])));for(const t of r)for(const[e,r]of t.entries())a[e+1].push(-r);h.push(...i.map((t=>-t)));const{solution:l,message:c}=k.solveQP(o,s,a,h,n);if(c.length)throw new Error("quadprog failed with: "+c);return l.shift(),l}(t,e,r,i,n);return o.push(0),o}function _(t,e,r){const i=1+Math.max(...e.values()),n=[],o=[];for(const s of t){let[t,...a]=s;for(const s of a){const a=e.getThrow(t.id),h=e.getThrow(s.id),l=new Array(i).fill(0);l[a]=1,l[h]=-1,n.push(l),o.push(-r(t,s)),t=s}}const s=new Array(i).fill(0);return[new Array(i).fill(null).map((()=>new Array(i).fill(0))),s,n,o]}function S(t,e,r,i){t[r][r]+=i,t[r][e]-=i,t[e][r]-=i,t[e][e]+=i}function R(t,e,r,i,n){t[i][i]+=n,t[i][r]-=2*n,t[i][e]+=n,t[r][i]-=2*n,t[r][r]+=4*n,t[r][e]-=2*n,t[e][i]+=n,t[e][r]-=2*n,t[e][e]+=n}function P(t,e,r){const i=Math.min(...r),n=Math.max(...r)-i;if(n>0)for(const o of t)for(const t of o){const o=e.getThrow(t.id);t.x=(r[o]-i)/n}else for(const e of t)for(const t of e)t.x=.5}class A extends h{constructor(t){super(t,void 0)}}function N(t,e,r,i,s){function a(n,a,h){const l=function(t){const e=new o;let r=0;for(const i of t)for(const t of i)e.set(t.id,r++);return e}(n),[c,f,u,d]=_(n,l,a);for(const o of n)for(const n of o){const o=l.getThrow(n.id),s=n instanceof A?e:t;for(const a of n.ichildren()){const n=l.getThrow(a.id),h=a instanceof A?i:r;S(c,o,n,s+(a instanceof A?e:t));for(const t of a.ichildren()){R(c,o,n,l.getThrow(t.id),h)}}}for(let[t,...e]of n)for(const r of e)h.getThrow(t.id)!==h.getThrow(r.id)&&S(c,l.getThrow(t.id),l.getThrow(r.id),s),t=r;P(n,l,z(c,f,u,d))}function h(s,h){if(0===t&&0===r)throw new Error("node vertical weight or node curve weight needs to be positive");if(0===e&&0===i)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const c=function(t){const e=new o;for(const r of t.slice().reverse())for(const t of r){for(const r of t.ichildren())e.delete(r.id);e.set(t.id,t)}const r=new l([...e.values()]).split(),i=new o;for(const[t,e]of r.entries())for(const r of e)i.set(r.id,t);return i}(s);for(const t of function(t,e){const r=[];let i=[],o=new Set;for(const s of t){const t=new Set(s.map((t=>e.getThrow(t.id))));n(o,t)||r.push(i=[]),i.push(s),o=t}return r}(s,c))if(t.every((t=>1===t.length)))for(const[e]of t)e.x=.5;else if(1===t.length){const[e]=t;T(e,h)}else a(t,h,c)}return h.vertical=function(n){if(void 0===n)return[t,e];const[o,a]=n;if(o<0||a<0)throw new Error(`weights must be non-negative, but were ${o} and ${a}`);return N(o,a,r,i,s)},h.curve=function(n){if(void 0===n)return[r,i];const[o,a]=n;if(o<0||a<0)throw new Error(`weights must be non-negative, but were ${o} and ${a}`);return N(t,e,o,a,s)},h.component=function(n){if(void 0===n)return s;if(n<=0)throw new Error("weight must be positive, but was "+n);return N(t,e,r,i,n)},h}function F(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return N(1,0,0,1,1)}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function q(t,e,r,i){this.feasible=r,this.evaluation=e,this.bounded=i,this._tableau=t}var D=q;function L(t,e,r,i,n){D.call(this,t,e,r,i),this.iter=n}q.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,r=e.varIndexByRow,i=e.variablesPerIndex,n=e.matrix,o=e.rhsColumn,s=e.height-1,a=Math.round(1/e.precision),h=1;h<=s;h+=1){var l=i[r[h]];if(void 0!==l&&!0!==l.isSlack){var c=n[h][o];t[l.id]=Math.round((Number.EPSILON+c)*a)/a}}return t};var U=L;function H(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}L.prototype=Object.create(D.prototype),L.constructor=L;var W=H;function J(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var r=0;r<e;r+=1)this.reducedCosts[r]=0}H.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},J.prototype.copy=function(){var t=new J(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t},H.prototype.setOptionalObjective=function(t,e,r){var i=this.objectivesByPriority[t];void 0===i&&(i=new J(t,Math.max(this.width,e+1)),this.objectivesByPriority[t]=i,this.optionalObjectives.push(i),this.optionalObjectives.sort((function(t,e){return t.priority-e.priority})));i.reducedCosts[e]=r},H.prototype.initialize=function(t,e,r,i){this.variables=r,this.unrestrictedVars=i,this.width=t,this.height=e;for(var n=new Array(t),o=0;o<t;o++)n[o]=0;this.matrix=new Array(e);for(var s=0;s<e;s++)this.matrix[s]=n.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},H.prototype._resetMatrix=function(){var t,e,r=this.model.variables,i=this.model.constraints,n=r.length,o=i.length,s=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(t=0;t<n;t+=1){var h=r[t],l=h.priority,c=a*h.cost;0===l?s[t+1]=c:this.setOptionalObjective(l,t+1,c),e=r[t].index,this.rowByVarIndex[e]=-1,this.colByVarIndex[e]=t+1,this.varIndexByCol[t+1]=e}for(var f=1,u=0;u<o;u+=1){var d,p,v=i[u],m=v.index;this.rowByVarIndex[m]=f,this.colByVarIndex[m]=-1,this.varIndexByRow[f]=m;var g=v.terms,y=g.length,w=this.matrix[f++];if(v.isUpperBound){for(d=0;d<y;d+=1)p=g[d],w[this.colByVarIndex[p.variable.index]]=p.coefficient;w[0]=v.rhs}else{for(d=0;d<y;d+=1)p=g[d],w[this.colByVarIndex[p.variable.index]]=-p.coefficient;w[0]=-v.rhs}}},H.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,r=t.nConstraints+1;return this.initialize(e,r,t.variables,t.unrestrictedVariables),this._resetMatrix(),this},H.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},H.prototype.density=function(){for(var t=0,e=this.matrix,r=0;r<this.height;r++)for(var i=e[r],n=0;n<this.width;n++)0!==i[n]&&(t+=1);return t/(this.height*this.width)},H.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],r=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=r,0===this.simplexIters&&(this.bestPossibleEval=r)},H.prototype.getSolution=function(){var t=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new U(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new D(this,t,this.feasible,this.bounded)},W.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},W.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],r=this.matrix,i=this.rhsColumn,n=this.width-1,o=this.height-1,s=0;;){for(var a=0,h=-this.precision,l=1;l<=o;l++){!0===this.unrestrictedVars[this.varIndexByRow[l]];var c=r[l][i];c<h&&(h=c,a=l)}if(0===a)return this.feasible=!0,s;for(var f=0,u=-1/0,d=r[0],p=r[a],v=1;v<=n;v++){var m=p[v];if(!0===this.unrestrictedVars[this.varIndexByCol[v]]||m<-this.precision){var g=-d[v]/m;u<g&&(u=g,f=v)}}if(0===f)return this.feasible=!1,s;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[f]]);var y=this.checkForCycles(e);if(y.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+y[0]),this.model.messages.push("Length :"+y[1]),this.feasible=!1,s}this.pivot(a,f),s+=1}},W.prototype.phase2=function(){for(var t,e,r=this.model.checkForCycles,i=[],n=this.matrix,o=this.rhsColumn,s=this.width-1,a=this.height-1,h=this.precision,l=this.optionalObjectives.length,c=null,f=0;;){var u=n[this.costRowIndex];l>0&&(c=[]);for(var d=0,p=h,v=!1,m=1;m<=s;m++)t=u[m],e=!0===this.unrestrictedVars[this.varIndexByCol[m]],l>0&&-h<t&&t<h?c.push(m):e&&t<0?-t>p&&(p=-t,d=m,v=!0):t>p&&(p=t,d=m,v=!1);if(l>0)for(var g=0;0===d&&c.length>0&&g<l;){var y=[],w=this.optionalObjectives[g].reducedCosts;p=h;for(var x=0;x<c.length;x++)t=w[m=c[x]],e=!0===this.unrestrictedVars[this.varIndexByCol[m]],-h<t&&t<h?y.push(m):e&&t<0?-t>p&&(p=-t,d=m,v=!0):t>p&&(p=t,d=m,v=!1);c=y,g+=1}if(0===d)return this.setEvaluation(),this.simplexIters+=1,f;for(var b=0,I=1/0,C=(this.varIndexByRow,1);C<=a;C++){var M=n[C],B=M[o],E=M[d];if(!(-h<E&&E<h)){if(E>0&&h>B&&B>-h){I=0,b=C;break}var V=v?-B/E:B/E;V>h&&I>V&&(I=V,b=C)}}if(I===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],f;if(r){i.push([this.varIndexByRow[b],this.varIndexByCol[d]]);var O=this.checkForCycles(i);if(O.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+O[0]),this.model.messages.push("Length :"+O[1]),this.feasible=!1,f}this.pivot(b,d,!0),f+=1}};var G=[];function Z(t,e,r,i){this.id=t,this.cost=e,this.index=r,this.value=0,this.priority=i}function Q(t,e,r,i){Z.call(this,t,e,r,i)}function Y(t,e){Z.call(this,t,0,e,0)}function K(t,e){this.variable=t,this.coefficient=e}function X(t,e,r){return 0===r||"required"===r?null:(e=e||1,r=r||1,!1===t.isMinimization&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,r))}function tt(t,e,r,i){this.slack=new Y("s"+r,r),this.index=r,this.model=i,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function et(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}W.prototype.pivot=function(t,e){var r=this.matrix,i=r[t][e],n=this.height-1,o=this.width-1,s=this.varIndexByRow[t],a=this.varIndexByCol[e];this.varIndexByRow[t]=a,this.varIndexByCol[e]=s,this.rowByVarIndex[a]=t,this.rowByVarIndex[s]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[s]=e;for(var h,l,c,f=r[t],u=0,d=0;d<=o;d++)f[d]>=-1e-16&&f[d]<=1e-16?f[d]=0:(f[d]/=i,G[u]=d,u+=1);f[e]=1/i;this.precision;for(var p=0;p<=n;p++)if(p!==t&&!(r[p][e]>=-1e-16&&r[p][e]<=1e-16)){var v=r[p];if((h=v[e])>=-1e-16&&h<=1e-16)0!==h&&(v[e]=0);else{for(l=0;l<u;l++)(c=f[d=G[l]])>=-1e-16&&c<=1e-16?0!==c&&(f[d]=0):v[d]=v[d]-h*c;v[e]=-h/i}}var m=this.optionalObjectives.length;if(m>0)for(var g=0;g<m;g+=1){var y=this.optionalObjectives[g].reducedCosts;if(0!==(h=y[e])){for(l=0;l<u;l++)0!==(c=f[d=G[l]])&&(y[d]=y[d]-h*c);y[e]=-h/i}}},W.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var r=e+1;r<t.length;r++){var i=t[e],n=t[r];if(i[0]===n[0]&&i[1]===n[1]){if(r-e>t.length-r)break;for(var o=!0,s=1;s<r-e;s++){var a=t[e+s],h=t[r+s];if(a[0]!==h[0]||a[1]!==h[1]){o=!1;break}}if(o)return[e,r-e]}}return[]},Q.prototype.isInteger=!0,Y.prototype.isSlack=!0,tt.prototype.addTerm=function(t,e){var r=e.index,i=this.termsByVarIndex[r];if(void 0===i)i=new K(e,t),this.termsByVarIndex[r]=i,this.terms.push(i),!0===this.isUpperBound&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var n=i.coefficient+t;this.setVariableCoefficient(n,e)}return this},tt.prototype.removeTerm=function(t){return this},tt.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;!0===this.isUpperBound&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this},tt.prototype.setVariableCoefficient=function(t,e){var r=e.index;if(-1!==r){var i=this.termsByVarIndex[r];if(void 0===i)this.addTerm(t,e);else if(t!==i.coefficient){var n=t-i.coefficient;!0===this.isUpperBound&&(n=-n),i.coefficient=t,this.model.updateConstraintCoefficient(this,e,n)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},tt.prototype.relax=function(t,e){this.relaxation=X(this.model,t,e),this._relax(this.relaxation)},tt.prototype._relax=function(t){null!==t&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))},et.prototype.isEquality=!0,et.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this},et.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this},et.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t},et.prototype.relax=function(t,e){this.relaxation=X(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var rt={Constraint:tt,Variable:Z,IntegerVariable:Q,SlackVariable:Y,Equality:et,Term:K},it=rt.SlackVariable;function nt(t,e){this.index=t,this.value=e}W.prototype.addCutConstraints=function(t){for(var e,r=t.length,i=this.height,n=i+r,o=i;o<n;o+=1)void 0===this.matrix[o]&&(this.matrix[o]=this.matrix[o-1].slice());this.height=n,this.nVars=this.width+this.height-2;for(var s=this.width-1,a=0;a<r;a+=1){var h=t[a],l=i+a,c="min"===h.type?-1:1,f=h.varIndex,u=this.rowByVarIndex[f],d=this.matrix[l];if(-1===u){for(d[this.rhsColumn]=c*h.value,e=1;e<=s;e+=1)d[e]=0;d[this.colByVarIndex[f]]=c}else{var p=this.matrix[u],v=p[this.rhsColumn];for(d[this.rhsColumn]=c*(h.value-v),e=1;e<=s;e+=1)d[e]=-c*p[e]}var m=this.getNewElementIndex();this.varIndexByRow[l]=m,this.rowByVarIndex[m]=l,this.colByVarIndex[m]=-1,this.variablesPerIndex[m]=new it("s"+m,m),this.nVars+=1}},W.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],i=r-Math.floor(r);if(i<this.precision||1-this.precision<i)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new it("s"+o,o),e[n][this.rhsColumn]=Math.floor(r);for(var s=1;s<this.varIndexByCol.length;s+=1){if(this.variablesPerIndex[this.varIndexByCol[s]].isInteger){var a=e[t][s],h=Math.floor(a)+Math.max(0,a-Math.floor(a)-i)/(1-i);e[n][s]=h}else e[n][s]=Math.min(0,e[t][s]/(1-i))}for(var l=0;l<this.width;l+=1)e[n][l]-=e[t][l];return!0},W.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],i=r-Math.floor(r);if(i<this.precision||1-this.precision<i)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new it("s"+o,o),e[n][this.rhsColumn]=-i;for(var s=1;s<this.varIndexByCol.length;s+=1){var a=this.variablesPerIndex[this.varIndexByCol[s]],h=e[t][s],l=h-Math.floor(h);a.isInteger?e[n][s]=l<=i?-l:-(1-l)*i/l:e[n][s]=h>=0?-h:h*i/(1-i)}return!0},W.prototype.applyMIRCuts=function(){},W.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(-1===e){for(var r=this.colByVarIndex[t],i=1;i<this.height;i+=1){var n=this.matrix[i][r];if(n<-this.precision||this.precision<n){e=i;break}}this.pivot(e,r)}return e},W.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(-1===e){for(var r=this.rowByVarIndex[t],i=this.matrix[r],n=1;n<this.height;n+=1){var o=i[n];if(o<-this.precision||this.precision<o){e=n;break}}this.pivot(r,e)}return e},W.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),r=0;r<t;r+=1){var i=this.variables[r],n=i.index,o=this.rowByVarIndex[n];if(-1===o)i.value=0;else{var s=this.matrix[o][this.rhsColumn];i.value=Math.round((s+Number.EPSILON)*e)/e}}},W.prototype.updateRightHandSide=function(t,e){var r=this.height-1,i=this.rowByVarIndex[t.index];if(-1===i){for(var n=this.colByVarIndex[t.index],o=0;o<=r;o+=1){var s=this.matrix[o];s[this.rhsColumn]-=e*s[n]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var l=this.optionalObjectives[h].reducedCosts;l[this.rhsColumn]-=e*l[n]}}else this.matrix[i][this.rhsColumn]-=e},W.prototype.updateConstraintCoefficient=function(t,e,r){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var i=this._putInBase(t.index),n=this.colByVarIndex[e.index];if(-1===n)for(var o=this.rowByVarIndex[e.index],s=0;s<this.width;s+=1)this.matrix[i][s]+=r*this.matrix[o][s];else this.matrix[i][n]-=r},W.prototype.updateCost=function(t,e){var r=t.index,i=this.width-1,n=this.colByVarIndex[r];if(-1===n){var o,s=this.matrix[this.rowByVarIndex[r]];if(0===t.priority){var a=this.matrix[0];for(o=0;o<=i;o+=1)a[o]+=e*s[o]}else{var h=this.objectivesByPriority[t.priority].reducedCosts;for(o=0;o<=i;o+=1)h[o]+=e*s[o]}}else this.matrix[0][n]-=e},W.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,r=this.height,i=this.matrix[r];void 0===i&&(i=this.matrix[0].slice(),this.matrix[r]=i);for(var n=this.width-1,o=0;o<=n;o+=1)i[o]=0;i[this.rhsColumn]=e*t.rhs;for(var s=t.terms,a=s.length,h=0;h<a;h+=1){var l=s[h],c=l.coefficient,f=l.variable.index,u=this.rowByVarIndex[f];if(-1===u)i[this.colByVarIndex[f]]+=e*c;else{var d=this.matrix[u];d[this.rhsColumn];for(o=0;o<=n;o+=1)i[o]-=e*c*d[o]}}var p=t.index;this.varIndexByRow[r]=p,this.rowByVarIndex[p]=r,this.colByVarIndex[p]=-1,this.height+=1},W.prototype.removeConstraint=function(t){var e=t.index,r=this.height-1,i=this._putInBase(e),n=this.matrix[r];this.matrix[r]=this.matrix[i],this.matrix[i]=n,this.varIndexByRow[i]=this.varIndexByRow[r],this.varIndexByRow[r]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1},W.prototype.addVariable=function(t){var e=this.height-1,r=this.width,i=!0===this.model.isMinimization?-t.cost:t.cost,n=t.priority,o=this.optionalObjectives.length;if(o>0)for(var s=0;s<o;s+=1)this.optionalObjectives[s].reducedCosts[r]=0;0===n?this.matrix[0][r]=i:(this.setOptionalObjective(n,r,i),this.matrix[0][r]=0);for(var a=1;a<=e;a+=1)this.matrix[a][r]=0;var h=t.index;this.varIndexByCol[r]=h,this.rowByVarIndex[h]=-1,this.colByVarIndex[h]=r,this.width+=1},W.prototype.removeVariable=function(t){var e=t.index,r=this._takeOutOfBase(e),i=this.width-1;if(r!==i){for(var n=this.height-1,o=0;o<=n;o+=1){var s=this.matrix[o];s[r]=s[i]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var l=this.optionalObjectives[h].reducedCosts;l[r]=l[i]}var c=this.varIndexByCol[i];this.varIndexByCol[r]=c,this.colByVarIndex[c]=r}this.varIndexByCol[i]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1},W.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var r,i,n,o,s,a,h,l,c,f,u="",d=[" "];for(i=1;i<this.width;i+=1)s=this.varIndexByCol[i],h=" ",l="\t",(a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id).length>5?h+=" ":l+="\t",d[i]=h,u+=l+a;console.log(u);var p=this.matrix[this.costRowIndex],v="\t";for(r=1;r<this.width;r+=1)v+="\t",v+=d[r],v+=p[r].toFixed(5);for(v+="\t"+d[0]+p[0].toFixed(5),console.log(v+"\tZ"),n=1;n<this.height;n+=1){for(c=this.matrix[n],f="\t",i=1;i<this.width;i+=1)f+="\t"+d[i]+c[i].toFixed(5);f+="\t"+d[0]+c[0].toFixed(5),s=this.varIndexByRow[n],a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id,console.log(f+"\t"+a)}console.log("");var m=this.optionalObjectives.length;if(m>0){console.log("    Optional objectives:");for(var g=0;g<m;g+=1){var y=this.optionalObjectives[g].reducedCosts,w="";for(r=1;r<this.width;r+=1)w+=y[r]<0?"":" ",w+=d[r],w+=y[r].toFixed(5);w+=(y[0]<0?"":" ")+d[0]+y[0].toFixed(5),console.log(w+" z"+g)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},W.prototype.copy=function(){var t=new W(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],r=0;r<this.optionalObjectives.length;r++)e[r]=this.optionalObjectives[r].copy();t.optionalObjectives=e;for(var i=this.matrix,n=new Array(this.height),o=0;o<this.height;o++)n[o]=i[o].slice();return t.matrix=n,t},W.prototype.save=function(){this.savedState=this.copy()},W.prototype.restore=function(){if(null!==this.savedState){var t,e,r=this.savedState,i=r.matrix;for(this.nVars=r.nVars,this.model=r.model,this.variables=r.variables,this.variablesPerIndex=r.variablesPerIndex,this.unrestrictedVars=r.unrestrictedVars,this.lastElementIndex=r.lastElementIndex,this.width=r.width,this.height=r.height,t=0;t<this.height;t+=1){var n=i[t],o=this.matrix[t];for(e=0;e<this.width;e+=1)o[e]=n[e]}var s=r.varIndexByRow;for(e=0;e<this.height;e+=1)this.varIndexByRow[e]=s[e];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=r.varIndexByCol;for(t=0;t<this.width;t+=1)this.varIndexByCol[t]=a[t];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var h=r.rowByVarIndex,l=r.colByVarIndex,c=0;c<this.nVars;c+=1)this.rowByVarIndex[c]=h[c],this.colByVarIndex[c]=l[c];if(r.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var f=0;f<r.optionalObjectives.length;f++){var u=r.optionalObjectives[f].copy();this.optionalObjectives[f]=u,this.optionalObjectivePerPriority[u.priority]=u}}}},W.prototype.getMostFractionalVar=function(){for(var t=0,e=null,r=null,i=this.model.integerVariables,n=i.length,o=0;o<n;o++){var s=i[o].index,a=this.rowByVarIndex[s];if(-1!==a){var h=this.matrix[a][this.rhsColumn],l=Math.abs(h-Math.round(h));t<l&&(t=l,e=s,r=h)}}return new nt(e,r)},W.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,r=null,i=this.model.integerVariables,n=i.length,o=0;o<n;o++){var s=i[o],a=s.index,h=this.rowByVarIndex[a];if(-1!==h){var l=this.matrix[h][this.rhsColumn];if(Math.abs(l-Math.round(l))>this.precision){var c=s.cost;t>c&&(t=c,e=a,r=l)}}}return new nt(e,r)},W.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var r=this.matrix[e][this.rhsColumn];(r-=Math.floor(r))<this.precision&&-r<this.precision&&(t+=1)}return t},W.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,r=0;r<e;r++){var i=this.rowByVarIndex[t[r].index];if(-1!==i){var n=this.matrix[i][this.rhsColumn];if(Math.abs(n-Math.round(n))>this.precision)return!1}}return!0},W.prototype.computeFractionalVolume=function(t){for(var e=-1,r=1;r<this.height;r+=1)if(this.variablesPerIndex[this.varIndexByRow[r]].isInteger){var i=this.matrix[r][this.rhsColumn];if(i=Math.abs(i),Math.min(i-Math.floor(i),Math.floor(i+1))<this.precision){if(!t)return 0}else-1===e?e=i:e*=i}return-1===e?0:e};var ot=W;function st(t,e,r){this.type=t,this.varIndex=e,this.value=r}function at(t,e){this.relaxedEvaluation=t,this.cuts=e}function ht(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}W.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var r=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*r&&(e=!1)}},W.prototype.branchAndCut=function(){var t=[],e=0,r=this.model.tolerance,i=!0,n=1e99;this.model.timeout&&(n=Date.now()+this.model.timeout);for(var o=1/0,s=null,a=[],h=0;h<this.optionalObjectives.length;h+=1)a.push(1/0);var l,c=new at(-1/0,[]);for(t.push(c);t.length>0&&!0===i&&Date.now()<n;)if(l=this.model.isMinimization?this.bestPossibleEval*(1+r):this.bestPossibleEval*(1-r),r>0&&o<l&&(i=!1),!((c=t.pop()).relaxedEvaluation>o)){var f=c.cuts;if(this.applyCuts(f),e++,!1!==this.feasible){var u=this.evaluation;if(!(u>o)){if(u===o){for(var d=!0,p=0;p<this.optionalObjectives.length&&!(this.optionalObjectives[p].reducedCosts[0]>a[p]);p+=1)if(this.optionalObjectives[p].reducedCosts[0]<a[p]){d=!1;break}if(d)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===e)return void(this.branchAndCutIterations=e);s=c,o=u;for(var v=0;v<this.optionalObjectives.length;v+=1)a[v]=this.optionalObjectives[v].reducedCosts[0]}else{1===e&&this.save();for(var m=this.getMostFractionalVar(),g=m.index,y=[],w=[],x=f.length,b=0;b<x;b+=1){var I=f[b];I.varIndex===g?"min"===I.type?w.push(I):y.push(I):(y.push(I),w.push(I))}var C=Math.ceil(m.value),M=Math.floor(m.value),B=new st("min",g,C);y.push(B);var E=new st("max",g,M);w.push(E),t.push(new at(u,y)),t.push(new at(u,w)),t.sort(ht)}}}}null!==s&&this.applyCuts(s.cuts),this.branchAndCutIterations=e};var lt={},ct=rt.Constraint,ft=rt.Equality,ut=rt.Variable,dt=rt.IntegerVariable;function pt(t,e){this.tableau=new W(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var vt=pt;pt.prototype.minimize=function(){return this.isMinimization=!0,this},pt.prototype.maximize=function(){return this.isMinimization=!1,this},pt.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},pt.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(t)},pt.prototype.smallerThan=function(t){var e=new ct(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},pt.prototype.greaterThan=function(t){var e=new ct(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},pt.prototype.equal=function(t){var e=new ct(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var r=new ct(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(r),new ft(e,r)},pt.prototype.addVariable=function(t,e,r,i,n){if("string"==typeof n)switch(n){case"required":n=0;break;case"strong":n=1;break;case"medium":n=2;break;case"weak":n=3;break;default:n=0}var o,s=this.tableau.getNewElementIndex();return null==e&&(e="v"+s),null==t&&(t=0),null==n&&(n=0),r?(o=new dt(e,t,s,n),this.integerVariables.push(o)):o=new ut(e,t,s,n),this.variables.push(o),this.tableau.variablesPerIndex[s]=o,i&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(o),o},pt.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e?(this.constraints.splice(e,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},pt.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this},pt.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(-1!==e)return this.variables.splice(e,1),!0===this.tableauInitialized&&this.tableau.removeVariable(t),this;console.warn("[Model.removeVariable] Variable not present in model")},pt.prototype.updateRightHandSide=function(t,e){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(t,e),this},pt.prototype.updateConstraintCoefficient=function(t,e,r){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(t,e,r),this},pt.prototype.setCost=function(t,e){var r=t-e.cost;return!1===this.isMinimization&&(r=-r),e.cost=t,this.tableau.updateCost(e,r),this},pt.prototype.loadJson=function(t){this.isMinimization="max"!==t.opType;for(var e=t.variables,r=t.constraints,i={},n={},o=Object.keys(r),s=o.length,a=0;a<s;a+=1){var h,l,c=o[a],f=r[c],u=f.equal,d=f.weight,p=f.priority,v=void 0!==d||void 0!==p;if(void 0===u){var m=f.min;void 0!==m&&(h=this.greaterThan(m),i[c]=h,v&&h.relax(d,p));var g=f.max;void 0!==g&&(l=this.smallerThan(g),n[c]=l,v&&l.relax(d,p))}else{h=this.greaterThan(u),i[c]=h,l=this.smallerThan(u),n[c]=l;var y=new ft(h,l);v&&y.relax(d,p)}}var w=Object.keys(e),x=w.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),0===this.tolerance&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),void 0===t.options.exitOnCycles?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var b=t.ints||{},I=t.binaries||{},C=t.unrestricted||{},M=t.optimize,B=0;B<x;B+=1){var E=w[B],V=e[E],O=V[M]||0,j=!!I[E],$=!!b[E]||j,k=!!C[E],T=this.addVariable(O,E,$,k);j&&this.smallerThan(1).addTerm(1,T);var z=Object.keys(V);for(a=0;a<z.length;a+=1){var _=z[a];if(_!==M){var S=V[_],R=i[_];void 0!==R&&R.addTerm(S,T);var P=n[_];void 0!==P&&P.addTerm(S,T)}}}return this},pt.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},pt.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},pt.prototype.isFeasible=function(){return this.tableau.feasible},pt.prototype.save=function(){return this.tableau.save()},pt.prototype.restore=function(){return this.tableau.restore()},pt.prototype.activateMIRCuts=function(t){this.useMIRCuts=t},pt.prototype.debug=function(t){this.checkForCycles=t},pt.prototype.log=function(t){return this.tableau.log(t)};var mt={CleanObjectiveAttributes:function(t){var e,r,i;if("string"==typeof t.optimize){if(t.constraints[t.optimize]){for(r in e=Math.random(),t.variables)t.variables[r][t.optimize]&&(t.variables[r][e]=t.variables[r][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}return t}for(i in t.optimize)if(t.constraints[i])if("equal"===t.constraints[i])delete t.optimize[i];else{for(r in e=Math.random(),t.variables)t.variables[r][i]&&(t.variables[r][e]=t.variables[r][i]);t.constraints[e]=t.constraints[i],delete t.constraints[i]}return t}};var gt=function(t){return t.length?function(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},r={opType:"",optimize:"_obj",constraints:{},variables:{}},i={">=":"min","<=":"max","=":"equal"},n="",o=null,s="",a="",h="",l=0;"string"==typeof t&&(t=t.split("\n"));for(var c=0;c<t.length;c++)if(h="__"+c,n=t[c],o=null,e.is_objective.test(n))r.opType=n.match(/(max|min)/gi)[0],(o=n.match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")})).slice(1)).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0].replace(/\;$/,""),r.variables[a]=r.variables[a]||{},r.variables[a]._obj=s}));else if(e.is_int.test(n))o=n.match(e.parse_int).slice(1),r.ints=r.ints||{},o.forEach((function(t){t=t.replace(";",""),r.ints[t]=1}));else if(e.is_bin.test(n))o=n.match(e.parse_bin).slice(1),r.binaries=r.binaries||{},o.forEach((function(t){t=t.replace(";",""),r.binaries[t]=1}));else if(e.is_constraint.test(n)){var f=n.indexOf(":");(o=(-1===f?n:n.slice(f+1)).match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")}))).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0],r.variables[a]=r.variables[a]||{},r.variables[a][h]=s})),l=parseFloat(n.match(e.parse_rhs)[0]),n=i[n.match(e.parse_dir)[0]],r.constraints[h]=r.constraints[h]||{},r.constraints[h][n]=l}else e.is_unrestricted.test(n)&&(o=n.match(e.parse_int).slice(1),r.unrestricted=r.unrestricted||{},o.forEach((function(t){t=t.replace(";",""),r.unrestricted[t]=1})));return r}(t):function(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",r={max:"<=",min:">=",equal:"="},i=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType)for(var n in e+=t.opType+":",t.variables)t.variables[n][n]=t.variables[n][n]?t.variables[n][n]:1,t.variables[n][t.optimize]&&(e+=" "+t.variables[n][t.optimize]+" "+n.replace(i,"_"));else e+="max:";for(var o in e+=";\n\n",t.constraints)for(var s in t.constraints[o])if(void 0!==r[s]){for(var a in t.variables)void 0!==t.variables[a][o]&&(e+=" "+t.variables[a][o]+" "+a.replace(i,"_"));e+=" "+r[s]+" "+t.constraints[o][s],e+=";\n"}if(t.ints)for(var h in e+="\n\n",t.ints)e+="int "+h.replace(i,"_")+";\n";if(t.unrestricted)for(var l in e+="\n\n",t.unrestricted)e+="unrestricted "+l.replace(i,"_")+";\n";return e}(t)};function yt(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})})),e}var wt=yt(Object.freeze({__proto__:null,default:{}}));function xt(t){return t=(t=(t=t.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(t){return!0!==new RegExp(" 0$","gi").test(t)&&!1!==new RegExp("\\d$","gi").test(t)})).map((function(t){return t.split(/\:{0,1} +(?=\d)/)})).reduce((function(t,e,r){return t[e[0]]=e[1],t}),{})}var bt={lpsolve:{reformat:gt,solve:function(t){return new Promise((function(e,r){"undefined"!=typeof window&&r("Function Not Available in Browser");var i=gt(t);t.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),wt.writeFile(t.external.tempName,i,(function(i,n){if(i)r(i);else{var o=wt.execFile;t.external.args.push(t.external.tempName),o(t.external.binPath,t.external.args,(function(t,i){if(t)if(1===t.code)e(xt(i));else{var n={code:t.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[t.code],data:i};r(n)}else e(xt(i))}))}}))}))}}},It=function(t,e){var r,i,n,o,s,a=e.optimize,h=JSON.parse(JSON.stringify(e.optimize)),l=Object.keys(e.optimize),c=0,f={},u="",d={},p=[];for(delete e.optimize,i=0;i<l.length;i++)h[l[i]]=0;for(i=0;i<l.length;i++){for(s in e.optimize=l[i],e.opType=a[l[i]],r=t.Solve(e,void 0,void 0,!0),l)if(!e.variables[l[s]])for(o in r[l[s]]=r[l[s]]?r[l[s]]:0,e.variables)e.variables[o][l[s]]&&r[o]&&(r[l[s]]+=r[o]*e.variables[o][l[s]]);for(u="base",n=0;n<l.length;n++)r[l[n]]?u+="-"+(1e3*r[l[n]]|0)/1e3:u+="-0";if(!f[u]){for(f[u]=1,c++,n=0;n<l.length;n++)r[l[n]]&&(h[l[n]]+=r[l[n]]);delete r.feasible,delete r.result,p.push(r)}}for(i=0;i<l.length;i++)e.constraints[l[i]]={equal:h[l[i]]/c};for(i in e.optimize="cheater-"+Math.random(),e.opType="max",e.variables)e.variables[i].cheater=1;for(i in p)for(o in p[i])d[o]=d[o]||{min:1e99,max:-1e99};for(i in d)for(o in p)p[o][i]?(p[o][i]>d[i].max&&(d[i].max=p[o][i]),p[o][i]<d[i].min&&(d[i].min=p[o][i])):(p[o][i]=0,d[i].min=0);return{midpoint:r=t.Solve(e,void 0,void 0,!0),vertices:p,ranges:d}},Ct=rt.Constraint,Mt=rt.Variable,Bt=rt.Numeral,Et=rt.Term,Vt=function(){this.Model=vt,this.branchAndCut=lt,this.Constraint=Ct,this.Variable=Mt,this.Numeral=Bt,this.Term=Et,this.Tableau=ot,this.lastSolvedModel=null,this.External=bt,this.Solve=function(t,e,r,i){if(i)for(var n in mt)t=mt[n](t);if(!t)throw new Error("Solver requires a model to operate on");if("object"==typeof t.optimize&&Object.keys(t.optimize>1))return It(this,t);if(t.external){var o=Object.keys(bt);if(o=JSON.stringify(o),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+o);if(!bt[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+o);return bt[t.external.solver].solve(t)}t instanceof vt==!1&&(t=new vt(e).loadJson(t));var s=t.solve();if(this.lastSolvedModel=t,s.solutionSet=s.generateSolutionSet(),r)return s;var a={};return a.feasible=s.feasible,a.result=s.evaluation,a.bounded=s.bounded,s._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(s.solutionSet).forEach((function(t){0!==s.solutionSet[t]&&(a[t]=s.solutionSet[t])})),a},this.ReformatLP=gt,this.MultiObjective=function(t){return It(this,t)}};"object"==typeof window?window.solver=new Vt:"object"==typeof self&&(self.solver=new Vt);var Ot=new Vt;function jt(t,e){const r=e?"":"\0",i=e?"rank: ":"\0",n=e?" -> ":"\0";function o(t){return`${r}${t.id}`}function s(t){return`${t.source.id}${n}${t.target.id}`}function a(t,e){return`${i}${t.id}${n}${e.id}`}function h(e){const r=Object.create(null),i=Object.create(null),n=Object.create(null),h=[];for(const n of e){const e=o(n);i[e]=1,r[e]={opt:n.children.length};const s=t(n);void 0!==s&&h.push([s,n])}for(const t of e.ilinks()){const e=r[o(t.source)],i=r[o(t.target)],a=s(t);n[a]={min:1},e[a]=-1,e.opt++,i[a]=1,i.opt--}let[l,...c]=h.sort((([t],[e])=>t-e));for(const t of c){const[e,i]=l,[s,h]=t,c=r[o(i)],f=r[o(h)],u=a(i,h);if(e<s)n[u]={min:1},c[u]=-1,f[u]=1;else{const t=a(h,i);n[u]={min:0},n[t]={min:0},c[u]=-1,c[t]=1,f[u]=1,f[t]=-1}l=t}const f=Ot.Solve({optimize:"opt",opType:"max",constraints:n,variables:r,ints:i}),{feasible:u}=f,d=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r}(f,["feasible"]);if(!u)throw h.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const t of e)t.layer=d[o(t)]||0}return h.rank=function(r){return void 0===r?t:jt(r,e)},h.debug=function(r){return void 0===r?e:jt(t,r)},h}function $t(){}function kt(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return jt($t,!1)}function Tt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function zt(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r<e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r<n||void 0===r&&n>=n)&&(r=n)}return r}function _t(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r>e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r>n||void 0===r&&n>=n)&&(r=n)}return r}function St(t,e,r=0,i=t.length-1,n=Tt){for(;i>r;){if(i-r>600){const o=i-r+1,s=e-r+1,a=Math.log(o),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1);St(t,e,Math.max(r,Math.floor(e-s*h/o+l)),Math.min(i,Math.floor(e+(o-s)*h/o+l)),n)}const o=t[e];let s=r,a=i;for(Rt(t,r,e),n(t[i],o)>0&&Rt(t,r,i);s<a;){for(Rt(t,s,a),++s,--a;n(t[s],o)<0;)++s;for(;n(t[a],o)>0;)--a}0===n(t[r],o)?Rt(t,r,a):(++a,Rt(t,a,i)),a<=e&&(r=a+1),e<=a&&(i=a-1)}return t}function Rt(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function Pt(t,e,r){if(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&(yield i)}}(t,r))).length){if((e=+e)<=0||i<2)return _t(t);if(e>=1)return zt(t);var i,n=(i-1)*e,o=Math.floor(n),s=zt(St(t,o).subarray(0,o+1));return s+(_t(t.subarray(o+1))-s)*(n-o)}}function At(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new o;for(const[e,i]of t.entries())for(const t of i.ichildren())r.setIfAbsent(t.id,[]).push(e);const i=new o;let n=-1;for(const o of e){const e=Pt(r.getDefault(o.id,[]),.5,void 0);void 0===e?(i.set(o.id,n),n=+!((n+1)/(t.length+1))*(t.length+1)-1):i.set(o.id,e)}e.sort(((t,e)=>i.getThrow(t.id)-i.getThrow(e.id)))}}function Nt(t){function e(e){e.slice(0,e.length-1).forEach(((r,i)=>t(r,e[i+1])))}return e.order=function(e){return void 0===e?t:Nt(e)},e}function Ft(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return Nt(At())}function qt(t,e,r,i,n,o,a){const[h,l]=n;function c(n){t(n);for(const t of n){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const c=function(t){const e=[];for(const r of t.descendants()){const t=r.layer;(e[t]||(e[t]=[])).push(r),r.dataChildren=r.dataChildren.map((i=>{const n=i.child.layer;if(n<=t)throw new Error(`layering left child node "${i.child.id}" (${n}) with a greater or equal layer to parent node "${r.id}" (${t})`);let o=i.child;for(let h=n-1;h>t;h--){let t;t=a?`${r.id}->${i.child.id} (${h})`:`${r.id}\0${i.child.id}\0${h}`;const n=new A(t);n.dataChildren.push(new s(o,void 0)),(e[h]||(e[h]=[])).push(n),o=n}return new s(o,i.data)}))}return e}(n);if(1===c.length){const[t]=c;for(const e of t)e.y=l/2}else{const t=i?l:l/(c.length-1);for(const[e,r]of c.entries())for(const i of r)i.y=t*e}if(c.every((t=>1===t.length)))for(const[t]of c)t.x=h/2;else if(1===c.length){const[t]=c;T(t,o);const e=t,r=i?e.length-1:1;for(const t of e)t.x*=h*r}else{e(c),r(c,o);for(const t of c)for(const e of t)if(void 0===e.x)throw new Error(`coord didn't assign an x to node '${e.id}'`);const t=c,n=i?Math.max(...c.map((t=>t.length)))-1:1;for(const e of t)for(const t of e)t.x*=h*n}const f=n;return function(t){for(const e of t)e instanceof A||(e.dataChildren=e.dataChildren.map((t=>{let r=t.child;const i=[{x:e.x,y:e.y}];for(;r instanceof A;)i.push({x:r.x,y:r.y}),[r]=r.ichildren();return i.push({x:r.x,y:r.y}),new s(r,t.data,i)})))}(f),f}return c.layering=function(s){return void 0===s?t:qt(s,e,r,i,n,o,a)},c.decross=function(s){return void 0===s?e:qt(t,s,r,i,n,o,a)},c.coord=function(s){return void 0===s?r:qt(t,e,s,i,n,o,a)},c.size=function(s){return void 0!==s?qt(t,e,r,!1,s,o,a):i?null:n},c.nodeSize=function(s){return void 0!==s?qt(t,e,r,!0,s,o,a):i?n:null},c.separation=function(s){return void 0===s?o:qt(t,e,r,i,n,s,a)},c.debug=function(s){return void 0===s?a:qt(t,e,r,i,n,o,s)},c}function Dt(t,e){return+!(t instanceof A)+ +!(e instanceof A)}function Lt(t){function e(e){if(t)for(const t of e.depth())t.layer=t.value;else!function(t){const e=Math.max(...t.iroots().map((t=>t.value)));for(const r of t)r.layer=e-r.value}(e.height())}return e.topDown=function(e){return void 0===e?t:Lt(e)},e}function Ut(...t){if(t.length)throw new Error(`got arguments to longestPath(${t}), but constructor takes no aruguments.`);return Lt(!0)}var Ht=function(t,e){return t<e};function Wt(t){if(!(this instanceof Wt))return new Wt(t);this.array=[],this.size=0,this.compare=t||Ht}Wt.prototype.clone=function(){var t=new Wt(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},Wt.prototype.add=function(t){var e,r,i=this.size;for(this.array[this.size]=t,this.size+=1;i>0&&(e=i-1>>1,r=this.array[e],this.compare(t,r));)this.array[i]=r,i=e;this.array[i]=t},Wt.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},Wt.prototype._percolateUp=function(t,e){for(var r,i,n=this.array[t];t>0&&(r=t-1>>1,i=this.array[r],e||this.compare(n,i));)this.array[t]=i,t=r;this.array[t]=n},Wt.prototype._percolateDown=function(t){for(var e,r,i,n=this.size,o=this.size>>>1,s=this.array[t];t<o&&(r=(e=1+(t<<1))+1,i=this.array[e],r<n&&this.compare(this.array[r],i)&&(e=r,i=this.array[r]),this.compare(i,s));)this.array[t]=i,t=e;this.array[t]=s},Wt.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},Wt.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},Wt.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),i=0;if("function"==typeof t&&this.size)for(var n=0;n<this.size&&i<r.length;)t(this.array[n])?(r[i]=this._removeAt(n),i++,n>>=1):n++;return r.length=i,r},Wt.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},Wt.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},Wt.prototype.peek=function(){if(0!=this.size)return this.array[0]},Wt.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},Wt.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},Wt.prototype.trim=function(){this.array=this.array.slice(0,this.size)},Wt.prototype.isEmpty=function(){return 0===this.size},Wt.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},Wt.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,i=new Wt((function(t,i){return e(r[t],r[i])}));t=Math.min(this.size,t);var n=new Array(t),o=0;for(i.add(0);o<t;){var s=i.poll();n[o++]=this.array[s];var a=1+(s<<1),h=a+1;a<this.size&&i.add(a),h<this.size&&i.add(h)}return n};var Jt=Wt;class Gt{constructor(){this.before=[],this.parents=[]}}function Zt(t){function e(e){const r=t||Math.floor(Math.sqrt(e.size()+.5)),n=new o(e.idescendants().map((t=>[t.id,new Gt])));for(const t of e)for(const e of t.ichildren())n.getThrow(e.id).parents.push(t);const s=new Jt((function(t,e){const r=n.getThrow(t.id).before,i=n.getThrow(e.id).before;for(const[t,e]of r.entries()){const r=i[t];if(void 0===r)return!1;if(e<r)return!0;if(r<e)return!1}return!0}));for(const t of e.iroots())s.add(t);let a,h=0,l=0,c=0;for(;a=s.poll();){c<r&&n.getThrow(a.id).parents.every((t=>i(t.layer)<l))?(a.layer=l,c++):(a.layer=++l,c=1);for(const t of a.ichildren()){const{before:e,parents:r}=n.getThrow(t.id);e.push(h),e.length===r.length&&(e.sort(((t,e)=>e-t)),s.add(t))}h++}}return e.width=function(e){if(void 0===e)return t;if(e<0)throw new Error("width must be non-negative: "+e);return Zt(e)},e}function Qt(t){const e=t?" => ":"\0\0",r=t?" ":"\0\0\0";function i(...t){return t.map((t=>t.id)).sort().join(e)}function n(t,e){e.sort(((t,e)=>+(t.id>e.id)||-1));for(const[r,n]of e.slice(0,e.length-1).entries())for(const o of e.slice(r+1)){const e=i(n,o);t.ints[e]=1,t.constraints[e]=Object.assign(Object.create(null),{max:1}),t.variables[e]=Object.assign(Object.create(null),{opt:0,[e]:1})}for(const[r,n]of e.slice(0,e.length-1).entries())for(const[o,s]of e.slice(r+1).entries())for(const a of e.slice(r+o+2)){const e=i(n,s),r=i(n,a),o=i(s,a),h=i(n,s,a),l=h+"+";t.constraints[l]=Object.assign(Object.create(null),{max:1}),t.variables[e][l]=1,t.variables[r][l]=-1,t.variables[o][l]=1;const c=h+"-";t.constraints[c]=Object.assign(Object.create(null),{min:0}),t.variables[e][c]=1,t.variables[r][c]=-1,t.variables[o][c]=1}}function o(e,n){for(const[o,s]of n.slice(0,n.length-1).entries())for(const a of n.slice(o+1)){const n=i(s,a);for(const o of s.ichildren())for(const s of a.ichildren()){if(o===s)continue;const a=i(o,s),h=t?`slack (${n}) (${a})`:`${n}\0\0\0${a}`,l=`${h}${r}+`,c=`${h}${r}-`;e.variables[h]=Object.assign(Object.create(null),{opt:1,[l]:1,[c]:1});const f=+(o.id>s.id),u=f||-1;e.constraints[l]=Object.assign(Object.create(null),{min:f}),e.variables[n][l]=1,e.variables[a][l]=u,e.constraints[c]=Object.assign(Object.create(null),{min:-f}),e.variables[n][c]=-1,e.variables[a][c]=-u}}}function s(t){const e={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};for(const r of t)n(e,r);for(const r of t.slice(0,t.length-1))o(e,r);const r=Ot.Solve(e);for(const e of t)e.sort(((t,e)=>(+(t.id>e.id)||-1)*(r[i(t,e)]||-1)))}return s.debug=function(e){return void 0===e?t:Qt(e)},s}function Yt(t){function e(e,r){F().vertical([(1-t)/2,(1-t)/2]).curve([t,t]).component(.5)(e,r)}return e.weight=function(e){if(void 0===e)return t;if(e<0||e>=1)throw new Error("weight must be in [0, 1), but was "+t);return Yt(e)},e}function Kt(t,e){for(const t of e)t.x=0;const r=new o;for(const e of t)for(const t of e.ichildren()){if(void 0===t.x)throw new Error(`unexpected undefined x for '${t.id}'`);const n=r.getDefault(t.id,0)+1;r.set(t.id,n),t.x+=(i(e.x)-t.x)/n}}class Xt{constructor(){this.mean=0,this.count=0}add(t){this.mean+=(t-this.mean)/++this.count}}function te(t){const e=t?" => ":"\0\0";function r(...t){return t.map((t=>t.id)).sort().join(e)}function i(t,e){const i={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};e.sort(((t,e)=>+(t.id>e.id)||-1));for(const[t,n]of e.slice(0,e.length-1).entries())for(const o of e.slice(t+1)){const t=r(n,o);i.ints[t]=1,i.constraints[t]=Object.assign(Object.create(null),{max:1}),i.variables[t]=Object.assign(Object.create(null),{opt:0,[t]:1})}for(const[t,n]of e.slice(0,e.length-1).entries())for(const[o,s]of e.slice(t+1).entries())for(const a of e.slice(t+o+2)){const t=r(n,s),e=r(n,a),o=r(s,a),h=r(n,s,a),l=h+"+";i.constraints[l]=Object.assign(Object.create(null),{max:1}),i.variables[t][l]=1,i.variables[e][l]=-1,i.variables[o][l]=1;const c=h+"-";i.constraints[c]=Object.assign(Object.create(null),{min:0}),i.variables[t][c]=1,i.variables[e][c]=-1,i.variables[o][c]=1}for(const[e,n]of t.slice(0,t.length-1).entries())for(const o of t.slice(e+1))for(const t of n.ichildren())for(const e of o.ichildren()){if(t===e)continue;const n=r(t,e);i.variables[n].opt+=+(t.id>e.id)||-1}const n=Ot.Solve(i);e.sort(((t,e)=>(+(t.id>e.id)||-1)*(+n[r(t,e)]||-1)))}return i.debug=function(e){return void 0===e?t:te(e)},i}function ee(t,e){const r=t.findIndex((t=>t<=e));return r>=0?r:t.length}function re(t,e){function r(r){const i=function(t){const e=[...t.idescendants("before")];for(const[t,r]of e.entries())r.layer=t;return e}(r),n=i.length-1;if(0===n){const[r]=i;r.x=t/2,r.y=e/2}else{!function(r,i,n){let o=0,s=0;for(const{source:t,target:e}of r.ilinks())if(e.layer>t.layer+1){const r=i.get(`${t.id}\0${e.id}`);if(void 0===r)throw new Error(`indexer didn't index ${t.id} -> ${e.id}`);o=Math.min(o,r),s=Math.max(s,r)}o===s&&(o=-1,s=1);for(const i of r)i.x=-o/(s-o)*t,i.y=i.layer/n*e;!function(r,i,n,o,s){for(const{source:a,target:h,points:l}of r.ilinks()){if(l.length=0,l.push({x:a.x,y:a.y}),h.layer-a.layer>1){const r=i.get(`${a.id}\0${h.id}`);if(void 0===r)throw new Error(`indexer didn't index ${a.id} -> ${h.id}`);const c=(r-o)/(s-o)*t,f=(a.layer+1)/n*e,u=(h.layer-1)/n*e;h.layer-a.layer>2?l.push({x:c,y:f},{x:c,y:u}):l.push({x:c,y:f})}l.push({x:h.x,y:h.y})}}(r,i,n,o,s)}(r,function(t){const e=new Map,r=[],i=[];for(const n of t)for(const t of n.children().sort(((t,e)=>t.layer-e.layer))){const o=`${n.id}\0${t.id}`;if(t.layer>n.layer+1){const s=ee(i,n.layer),a=ee(r,n.layer);s<a?(e.set(o,-s-1),i[s]=t.layer-1):(e.set(o,a+1),r[a]=t.layer-1)}}return e}(i),n)}return r}return r.size=function(r){if(void 0===r)return[t,e];{const[t,e]=r;return re(t,e)}},r}function ie(t){function e(e){const r=new o,i=new o;for(const t of e.slice().reverse())for(const e of t){r.set(e.id,e);let t=0;for(const n of e.ichildren())r.delete(n.id),t+=i.getThrow(n.id);i.set(e.id,Math.max(t,1))}let n=0;for(const e of r.values()){const r=i.getThrow(e.id);e.columnIndex=n+(t?Math.floor((r-1)/2):0),s(e,n),n+=r}function s(e,r){let n=r;for(const r of e.ichildren()){if(void 0!==r.columnIndex)return;const e=i.getThrow(r.id);r.columnIndex=n+(t?Math.floor((e-1)/2):0),s(r,n),n+=e}}}return e.center=function(e){return void 0===e?t:ie(e)},e}function ne(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return ie(!1)}function oe(...t){if(t.length)throw new Error(`got arguments to spread(${t}), but constructor takes no aruguments.`);return function(t,e,r){const i=Math.max(...t.map((t=>Math.max(...t.map((t=>t.columnIndex))))))+1,n=[];for(let t=0;t<i;++t)n.push(e(t));const o=[0];for(let t=0;t<i-1;++t){const e=o[t]+n[t]+r(t);o.push(e)}const s=o[i-1]+n[i-1];for(const e of t)for(const t of e){const e=o[t.columnIndex],r=n[t.columnIndex];t.x0=e/s,t.x1=(e+r)/s}}}class se extends h{constructor(t){super(t,void 0)}}function ae(t,e,r,i,n,a,h,l,c,f,u){function d(d){const p=function(t){const e=new o;for(const r of t.idescendants("after")){const t=Math.max(0,...r.ichildren().map((t=>e.getThrow(t.id))));e.set(r.id,u(r)+t)}return e}(d);i(d);for(const t of d){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const v=function(e){const r=[],i=Math.max(...e.idescendants().map((t=>t.layer)));for(const n of e){const e=n.layer;if((r[e]||(r[e]=[])).push(n),n.dataChildren=n.dataChildren.map((i=>{const o=i.child.layer;if(o<=e)throw new Error(`layering left child node "${i.child.id}" (${o}) with a greater or equal layer to parent node "${n.id}" (${e})`);let a=i.child;for(let h=o-1;h>e;h--){let e;e=t?`${n.id}->${i.child.id} (${h})`:`${n.id}\0${i.child.id}\0${h}`;const o=new se(e);o.dataChildren.push(new s(a,void 0)),(r[h]||(r[h]=[])).push(o),a=o}return new s(a,i.data)})),0===n.dataChildren.length&&e<i){let e=new se(t?`${n.id} (${i})`:`${n.id}\0${i}`);(r[i]||(r[i]=[])).push(e);for(let o=i-1;o>n.layer;o--){const a=new se(t?`${n.id} (${i})`:`${n.id}\0${i}`);a.dataChildren.push(new s(e,void 0)),(r[o]||(r[o]=[])).push(a),e=a}n.dataChildren=[new s(e,void 0)]}}return r}(d);let m;if(1===v.length){const[t]=v;for(const e of t)e.y0=0,e.y1=1;m=1}else{const t=function(t){const e=new o;for(const r of t.idescendants("before")){const t=e.getDefault(r.id,0)+u(r);e.set(r.id,t);for(const i of r.ichildren()){const r=Math.max(t,e.getDefault(i.id,0));e.set(i.id,r)}}return e}(d);let e=v[0];const r=Math.max(...e.map((t=>p.getThrow(t.id))));for(const r of e){const e=r.y1=t.getThrow(r.id);r.y0=e-u(r)}m=0;for(const[r,i]of v.slice(1).entries()){m+=l(e,i,r);for(const e of i){const r=e.y1=m+t.getThrow(e.id);e.y0=r-u(e)}e=i}m+=r}n(v),a(v);for(const t of v)for(const e of t){if(void 0===e.columnIndex)throw new Error(`column did not assign an index to node '${e.id}'`);if(e.columnIndex<0)throw new Error(`column assigned a negative index (${e.columnIndex}) to node '${e.id}'`)}h(v,c,f);for(const t of v)for(const e of t){if(void 0===e.x0||void 0===e.x1)throw new Error(`coord did not assign both x coordinates to node '${e.id}'`);if(e.x0>e.x1)throw new Error(`coord did not assign valid x coordinates to node '${e.id}'`)}const g=d;return function(t,i){for(const n of t)n.x0*=e,n.x1*=e,n.y0*=r/i,n.y1*=r/i}(g,m),function(t){for(const e of t)if(!(e instanceof se)){const t=[];for(const r of e.dataChildren){let i=r.child;const n=[{x:(e.x0+e.x1)/2,y:e.y1}];for(;void 0!==i&&i instanceof se;)n.push({x:(i.x0+i.x1)/2,y:i.y0}),[i]=i.ichildren();if(void 0!==i){n.push({x:(i.x0+i.x1)/2,y:i.y0});const e=new s(i,r.data,n);t.push(e)}}e.dataChildren=t}}(g),g}return d.size=function(o){if(void 0===o)return[e,r];{const[e,r]=o;return ae(t,e,r,i,n,a,h,l,c,f,u)}},d.layering=function(o){return void 0===o?i:ae(t,e,r,o,n,a,h,l,c,f,u)},d.decross=function(o){return void 0===o?n:ae(t,e,r,i,o,a,h,l,c,f,u)},d.column=function(o){return void 0===o?a:ae(t,e,r,i,n,o,h,l,c,f,u)},d.coord=function(o){return void 0===o?h:ae(t,e,r,i,n,a,o,l,c,f,u)},d.layerSeparation=function(o){return void 0===o?l:ae(t,e,r,i,n,a,h,o,c,f,u)},d.columnWidth=function(o){return void 0===o?c:ae(t,e,r,i,n,a,h,l,o,f,u)},d.columnSeparation=function(o){return void 0===o?f:ae(t,e,r,i,n,a,h,l,c,o,u)},d}function he(){return 1}function le(){return 10}function ce(){return 1}function fe(t){if(t instanceof se)return 0;if(function(t){const e=t.heightRatio;return void 0===e||"number"==typeof e}(t))return t.heightRatio||0;throw new Error("default height ratio expects node with heightRatio property but got nothing")}function ue(t){function e(e){const r=new o;for(const t of e)for(const e of t)for(const t of e.ichildren())r.setIfAbsent(t.id,[]).push(e);const n=Math.max(...e.map((t=>t.length))),s=e.findIndex((t=>t.length===n));for(const[t,r]of e[s].entries())r.columnIndex=t;for(const t of e.slice(0,s).reverse())a(t);for(const t of e.slice(s+1))h(t);function a(e){if(e.length===n)for(const[t,r]of e.entries())r.columnIndex=t;else{const r=l(e.map(((e,r)=>{if(0===e.dataChildren.length)return r;const n=[...e.ichildren().map((t=>i(t.columnIndex)))];return t?n.sort(((t,e)=>t-e))[Math.floor((n.length-1)/2)]:Math.min(...n)})));for(const[t,i]of e.entries())i.columnIndex=r[t]}}function h(e){if(e.length===n)for(const[t,r]of e.entries())r.columnIndex=t;else{const n=l(e.map(((e,n)=>{const o=r.getDefault(e.id,[]);if(0===o.length)return n;const s=o.map((t=>i(t.columnIndex)));return t?s[Math.floor((s.length-1)/2)]:Math.min(...s)})));for(const[t,r]of e.entries())r.columnIndex=n[t]}}function l(t){for(const e of t)if(!isFinite(e))throw new Error("columnComplex: non-finite column index encountered");let e=-1;t=t.map((t=>(t<=e&&(t=e+1),e=t,t)));const r=Math.max(...t)-(n-1);return r>0&&(t=t.map(((t,e)=>Math.max(t-r,e)))),t}}return e.center=function(e){return void 0===e?t:ue(e)},e}t.ArqDummyNode=se,t.SugiDummyNode=A,t.arqcoordSpread=oe,t.arquint=function(){return ae(!1,1,1,Ut().topDown(!1),Ft(),ne(),oe(),he,le,ce,fe)},t.columnAdjacent=function(...t){if(t.length)throw new Error(`got arguments to adjacent(${t}), but constructor takes no aruguments.`);return ue(!1)},t.columnCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t){const e=Math.max(...t.map((t=>t.length)));for(const r of t){const t=Math.floor((e-r.length)/2);for(const[e,i]of r.entries())i.columnIndex=t+e}}},t.columnComplex=ne,t.columnLeft=function(...t){if(t.length)throw new Error(`got arguments to left(${t}), but constructor takes no aruguments.`);return function(t){for(const e of t)for(const[t,r]of e.entries())r.columnIndex=t}},t.coordCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t,e){const r=Math.max(...t.map((t=>{let[r,...i]=t,n=r.x=0;for(const t of i)n=t.x=n+e(r,t),r=t;return n})));if(r>0)for(const e of t){const t=i(e[e.length-1].x)/2;for(const n of e)n.x=(i(n.x)-t)/r+.5}else for(const e of t)for(const t of e)t.x=.5}},t.coordGreedy=function(...t){if(t.length)throw new Error(`got arguments to greedy(${t}), but constructor takes no aruguments.`);return function(t,e){const r=Kt,n=new o;for(const e of t)for(const t of e)n.set(t.id,t.ichildren().length+(t instanceof A?-3:0));for(const e of t)for(const t of e)for(const e of t.ichildren())n.set(e.id,n.getThrow(e.id)+1);let[s,...a]=t,[h,...l]=s,c=h.x=0;for(const t of l)c=t.x=c+e(h,t),h=t;for(const t of a){r(s,t);const o=t.map(((t,e)=>[e,t])).sort((([t,e],[r,i])=>{const o=n.getThrow(e.id),s=n.getThrow(i.id);return o===s?t-r:s-o}));for(const[r,n]of o){let o=n,s=i(o.x);for(const n of t.slice(r+1))s=n.x=Math.max(i(n.x),s+e(o,n)),o=n;o=n,s=i(o.x);for(const n of t.slice(0,r).reverse())s=n.x=Math.min(i(n.x),s-e(n,o)),o=n}s=t}const f=Math.min(...t.map((t=>Math.min(...t.map((t=>i(t.x))))))),u=Math.max(...t.map((t=>Math.max(...t.map((t=>i(t.x)))))))-f;if(u>0)for(const e of t)for(const t of e)t.x=(i(t.x)-f)/u;else for(const e of t)for(const t of e)t.x=.5}},t.coordMinCurve=function(...t){if(t.length)throw new Error(`got arguments to minCurve(${t}), but constructor takes no aruguments.`);return Yt(.5)},t.coordQuad=F,t.coordTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t,e){for(const e of t){if(1!==e.reduce(((t,e)=>t+ +!(e instanceof A)),0))throw new Error("topological() only works with a topological layering")}const r=new o;let i=0;for(const e of t)for(const t of e)t instanceof A&&r.set(t.id,i++);for(const e of t)for(const t of e)t instanceof A||r.set(t.id,i);const[n,s,a,h]=_(t,r,e);for(const e of t)for(const t of e){const e=r.getThrow(t.id);for(const i of t.ichildren()){const t=r.getThrow(i.id);if(i instanceof A)for(const o of i.ichildren()){R(n,e,t,r.getThrow(o.id),1)}}}P(t,r,z(n,s,a,h))}},t.coordVert=F,t.dagConnect=function(...t){if(t.length)throw new Error(`got arguments to dagConnect(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagConnect()(...)`);return m(g,y)},t.dagHierarchy=function(...t){if(t.length)throw Error(`got arguments to dagHierarchy(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagHierarchy()(...)`);return w(b,I,x(I))},t.dagStratify=function(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return u(p,v,d(v))},t.decrossOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return Qt(!1)},t.decrossTwoLayer=Ft,t.layeringCoffmanGraham=function(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return Zt(0)},t.layeringLongestPath=Ut,t.layeringSimplex=kt,t.layeringTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t){for(const[e,r]of t.idescendants("before").entries())r.layer=e}},t.sugiyama=function(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return qt(kt(),Ft(),F(),!1,[1,1],Dt,!1)},t.twolayerMean=function(...t){if(t.length)throw new Error(`got arguments to mean(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new o(e.map((t=>[t.id,new Xt])));for(const[e,i]of t.entries())for(const t of i.ichildren())r.getThrow(t.id).add(e);e.sort(((t,e)=>r.getThrow(t.id).mean-r.getThrow(e.id).mean))}},t.twolayerMedian=At,t.twolayerOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return te(!1)},t.zherebko=function(...t){if(t.length)throw new Error(`got arguments to zherebko(${t}), but constructor takes no aruguments.`);return re(1,1)},Object.defineProperty(t,"__esModule",{value:!0})}));
